帧同步
******

.. author:: default
.. categories:: Game Develop
.. tags:: Game Develop, Network
.. comments::

什么是帧同步？
============
同步什么？
------------

为什么使用帧同步？
===================


帧同步的基本流程
==============

使用什么网络协议
==============

服务端模型
===========


开始战斗，中途加入与退出、切换英雄
=================================
在此，帧同步仅针对Combat对象，即帧数据由Combat对象来处理。

如果允许中途加入，进入战斗的命令需要特殊处理，因为角色进入战斗的初始命令肯定是普通(非帧)命令，所以需要
将进入战斗的普通命令转换为帧命令，告知其它客户端新角色进入。

战斗(Combat)如何开始？
-----------------------
对于C/S结构，多个Client连接到Server，然后相继(同时)点击开始战斗，Server开始收集所有Client的输入，
并定期(如50ms)发送给所有客户端。

当多个客户端匹配好之后，选择好英雄。Server收到第一个开启战斗命令时，开始帧驱动计时，计时达到后，将收集
到的数据发送给所有客户端，客户端开始被帧驱动前进。

还有一个问题客户端界面如何展示。 通常英雄选择是一个界面，当玩家选择好之后，什么时机将这个界面隐藏？
当客户端点击进入战斗后，后台开始加载相关资源，当收到自己加入战斗的帧数据后，隐藏掉英雄选择界面，显示战斗场景。
战斗中切换英雄会出现同样的问题，何时隐藏英雄选择界面？同样处理。

如何中途加入战斗？
-------------------
在Server发出第一个帧数据包后进入战斗的都是中途加入。当收到进入战斗命令后，进行一系列检查后，满足条件，
就转换为进入战斗的帧命令，加入到服务器的帧数据包中即可。

客户端收到新角色加入的帧命令即创建一个对应的英雄。

中途退出和战斗中切换英雄与加入战斗类似。需要一个特殊的帧命令来完成。

选择英雄的条件处理
------------------
由于帧数据是间隔处理的，如何保证在一帧的间隔内，能够满足条件。如：某个英雄只能选一个，如何保证这个条件？
加入游戏时要检查，战斗中切换英雄时要检查，即在哪里记录战斗中所选择的英雄信息，如何避免进入失败。(为什么会
进入失败？玩家A在战斗外说我选择英雄1进入战斗，战斗中玩家B说我要切换为英雄1，同一帧内玩家C也说我要切换到英雄1，
肯定只能让一个人成功，那么如何通知切换英雄失败？)无法避免进入失败，做好进入失败提示即可。

那么进入失败通过什么方式（帧命令还是普通命令）告知玩家？看上去都可以。

其它问题
========
*   与非帧命令的结合。输入/离开房间
*   相关命令的帧命令化。如，切换英雄，玩家中途进入、退出、掉线


参考资料
=======
