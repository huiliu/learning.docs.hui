测试MySQL服务器性能
********************

测试的目的
===========
希望了解当前MySQL Server的下面两个重要的性能指标

* 并发
* 磁盘IO

工具
=====
* MySQL发行版自带了一个测试程序`mysqlslap`。
* `sysbench`_\ 是一款开源的测试工具
* `sysstat`_\ 提供的命令`iostat`可\
  以读取磁盘读写性能数据，便于统计分析磁盘IO
* 使用\ `GNUPlot`_ 对数据进行作图

.. _sysbench: http://sysbench.sourceforge.net/
.. _sysstat: http://pagesperso-orange.fr/sebastien.godard/
.. _GNUPlot: http://www.gnuplot.info/

命令\ ``iostat``\ 说明
-----------------------

命令\ ``iostat``\ 会读取文件"*/proc/diskstat*'中关于磁盘的数据\ [#ref1]_：

.. sourcecode:: bash

    iostat -kxd /dev/sda5
    Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
    sda5              0.01     1.36    0.54    5.43     3.72   149.66    51.39     0.03    4.58    5.17    4.53   2.05   1.22
    
参数说明
^^^^^^^^^^

+------------------------+------------------------------------------------------------------------------------+
|   参数                 |      说明                                                                          |
+========================+====================================================================================+
| rrqm/s                 |  每秒中处于队列中的写操作请求数目                                                  |
+------------------------+------------------------------------------------------------------------------------+
| wrqm/s                 |  每秒中处于队列中的读操作请求数目                                                  |
+------------------------+------------------------------------------------------------------------------------+
| r/s                    |  每秒完成的写操作请求数目                                                          |
+------------------------+------------------------------------------------------------------------------------+
| w/s                    |  每秒完成的读操作请求数目                                                          |
+------------------------+------------------------------------------------------------------------------------+
| rsec/s (rkB/s, rMB/s)  |  每秒从设备读取了多少数据(不同一列名，单位分别为sections, Kb, Mb)                  |
+------------------------+------------------------------------------------------------------------------------+
| rsec/s (wkB/s, wMB/s)  |  每秒向设备写入了多少数据(不同一列名，单位分别为sections, Kb, Mb)                  |
+------------------------+------------------------------------------------------------------------------------+
| avgrq-sz               |  向设备请求的平均大小(单位为sectors)                                               |
+------------------------+------------------------------------------------------------------------------------+
| avgqu-sz               |  向设备请求的平均队列长度                                                          |
+------------------------+------------------------------------------------------------------------------------+
| await                  |  I/O的平均等待时间（从发出请求到IO操作完成）。包括I/O排队时间和I/O操作时间         |
+------------------------+------------------------------------------------------------------------------------+
| r_await                |  读操作的平均等待时间（从发出请求到IO操作完成）。包括I/O排队时间和I/O操作时间      |
+------------------------+------------------------------------------------------------------------------------+
| w_await                |  写操作的平均等待时间（从发出请求到IO操作完成）。包括I/O排队时间和I/O操作时间      |
+------------------------+------------------------------------------------------------------------------------+
| svctm                  |  I/O操作执行的平均耗时。（此字段不可信）                                           |
+------------------------+------------------------------------------------------------------------------------+
| %util                  |  设备处理I/O请求时消耗的CPU时间百分比。这个值接近100%时说明设备处于満负荷工作状态  |
+------------------------+------------------------------------------------------------------------------------+

命令mysqlslap说明
--------------------
``mysqlslap``\ 有以下常用参数\ [#ref2]_:

* -a | –auto-generate-sql   自动产生测试SQL
* –defaults-file，配置文件存放位置
* -c | –concurrency \<int\>         并发数
* -i | –iterations \<int\>    迭代的实验次数

另外一些更为高级的控制：

* –engines，引擎
* –auto-generate-sql-load-type，测试SQL的类型。类型有mixed，update，write，key，read。
* –number-of-queries，执行的SQL总数量
* –number-int-cols，表内int列的数量
* –number-char-cols，表内char列的数量
* –socket，socket文件位置

参考资料
==========
.. [#ref1] http://www.dbasquare.com/2012/04/18/analyzing-io-performance/
.. [#ref2] http://www.taobaodba.com/html/200_mysql%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%EF%BC%9Amysqlslap.html
