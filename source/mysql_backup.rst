MySQL数据库的备份
*****************

备份类型
=========
物理备份与逻辑备份
------------------
**物理备份**\ 直接备份MySQL Server的数据文件，适用于数据量大，比较重要并且需要快速恢复的数据。其特点有:\

1.  比逻辑备份快（为什么？）
2.  进行备份操作时需要MySQL Server停止服务或者禁止改变数据库内容的操作
3.  备份粒度
4.  可以方便备份与数据库相关的配置，日志信息

**逻辑备份**\ 通过向MySQL Server发生请求以获取数据库的结构和内容信息并进行保存。其特点有：

1.  比物理备份慢（为什么？）
2.  备份文件相对较大（为什么？）
3.  备份、恢复的粒度更小
4.  备份后的数据与机器无关，便于恢复
5.  需要MySQL Server处于运行状态

在线备份和离线备份
------------------


本地备份和远程备份
------------------

执行SQL语句\ ``SELECT ... INTO OUTFILE``\ 可以将数据输出到MySQL Server上的某个文件中（无论在本地还是远程执行此语句）。


快照备份
---------
利用文件系统（LVM, ZFS）的快照功能（snapshot）可以对数据库所在的文件分区进行快照备份。（需要对文件系统进行合理的设计）


全备份和增量备份，以及PIT(Point-in-Time)恢复
------------------------------------------------


表维护
------

备份方法
========
直接备份数据库文件
------------------
对于使用\ ``MyISAM``\ 引擎的数据表，可能通过直接复制其数据文件（\ ``*.frm, *.MYD, *.MYI``\ ）来进行备份。为了保证备份时数据不会发生改变，应该停止服务器运行或对相关的数据表进行锁表操作：

.. sourcecode:: sql

    FLUSH TABLES tbl_list WITH READ LOCK;

另外也可以使用工具\ ``mysqlhotcopy``\ 完成相同的任务。由于存储引擎\ ``InnoDB``\ 的特性（并不一定并数据存放在相应的数据库目录下，另外即使服务器没有更新硬盘数据，也可能在修改缓存于内存中的数据而没有将其回写到硬盘）,\ ``mysqlhotcopy``\ 并不适用于使用\ ``InnoDB``\ 引擎的表进行备份。

将数据备份到分隔符文件
-----------------------
``SELECT * INTO OUTFILE 'file_name' FROM tbl_name``\ 可以将数据导出到MySQL Server上，注意保存文件\ ``file_name``\ 不能存在（安全方面的考量），另外此方法只能保存数据，不会导出表结构。

使用命令\ ``mysqldump``\ 和\ ``--tab``\ 选项可以完成相同的操作，同时可以导出表结构（包含CREATE TABLE语句）。

使用\ ``LOAD DATA INFILE``\ 或命令\ ``mysqlimport``\ 可以将导出的数据恢复至数据库。


增量备份
--------
开启\ ``binlog``\ 功能后可以对数据库进行增量备份。进行增量备份时，必须首先刷新\ ``binlog``\ ：\ ``FLUSH LOGS``\ 。另外也可以使用命令：\ ``mysqldump --flush-logs``\ 或\ ``mysqlimport --flush-logs``\ 。

使用从库
--------


恢复受损表
----------
对于使用\ ``MyISAM``\ 引擎的表，如果发生损坏，可以使用\ ``REPAIR TABLE``\ 或者\ ``myisamchk -r``\ 来进行恢复，有99.9%的几率修复数据。


使用文件系统快照
----------------
一般可以执行下面步骤：

1.  从客户端登陆并执行：\ ``FLUSH TABLES WITH READ LOCK``
2.  从另外一个Shell执行文件系统快照操作
3.  从客户端执行解锁：\ ``UNLOCK TABLES``
4.  将快照文件拷贝备份


参考资料
========
1.  http://dev.mysql.com/doc/mysql-backup-excerpt/5.5/en/backup-types.html
2.  http://dev.mysql.com/doc/mysql-backup-excerpt/5.5/en/backup-methods.html
